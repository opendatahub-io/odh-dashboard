"use strict";(self.webpackChunkmodel_registry_ui=self.webpackChunkmodel_registry_ui||[]).push([[859],{36842:(e,t,a)=>{a.d(t,{A:()=>l});var n=a(48348),r=a(12895);const l=()=>{const{user:e}=(0,n.useContext)(r.B);return e}},76859:(e,t,a)=>{a.d(t,{A:()=>je});var n=a(48348),r=a.n(n),l=a(54557),i=a(85130),s=a(56862),o=a(79438),m=a(25538),c=a(65389),d=a(3670),u=a(32598),p=a(9226),g=a(5878);const E=e=>{const t=(0,u.r)(e),a=n.useMemo(()=>(0,g.Oi)("",t),[t]),r=n.useCallback(e=>a(e),[a]);return(0,p.vT)(r,[],{initialPromisePurity:!0})};var b=a(15987);const y=e=>{const t=(0,u.r)(e),a=n.useCallback(()=>(0,g.Jw)("",t)({}).catch(e=>{if(404===e.response?.status)throw new Error("No rolebindings found.");throw e}),[t]),[r,l,i,s]=(0,p.vT)(a,[],{refreshRate:b.a});return{data:r,loaded:l,error:i,refresh:s}};var f=a(74059);const h=[{field:"model regisry name",label:"Model registry name",sortable:(e,t)=>e.metadata.name.localeCompare(t.metadata.name),width:30},{field:"status",label:"Status",sortable:!1},{field:"manage permissions",label:"",sortable:!1},(0,a(47666).oX)()];var R,v,T,S=a(36645),w=a(65365),C=a(52577),I=a(12689),k=a(6938),B=a(99507),N=a(99851),D=a(19202),A=a(31003);!function(e){e.Progressing="Progressing",e.Degraded="Degraded",e.Available="Available",e.IstioAvailable="IstioAvailable",e.GatewayAvailable="GatewayAvailable"}(R||(R={})),function(e){e.Progressing="Progressing",e.Available="Available",e.Degrading="Degrading",e.Unavailable="Unavailable"}(v||(v={})),function(e){e.True="True",e.False="False"}(T||(T={}));const x=({conditions:e})=>{const t=e?.reduce((e,t)=>(e[t.type]=t,e),{})??{};let a,n=v.Progressing,l=r().createElement(B.It,null),s=[],o="";if(Object.values(t).length){const{[R.Available]:e,[R.Progressing]:i,[R.Degraded]:m}=t;s=e?.status===T.False?Object.values(t).reduce((e,t)=>(t?.status===T.False&&t.message&&e.push(t.message),e),[]):[],e?.status!==T.False||s.some(e=>e.includes("ContainerCreating"))?m?.status===T.True?(n=v.Degrading,l=r().createElement(B.It,{className:"kubeflow-u-spin"}),o="Service is degrading"):e?.status===T.True?(n=v.Available,l=r().createElement(D.C1,null),a="success"):i?.status===T.True&&(n=v.Progressing,l=r().createElement(B.It,{className:"kubeflow-u-spin"}),a="info"):(n=v.Unavailable,l=r().createElement(N.Pi,null),a="warning")}if(n===v.Unavailable){const{[R.IstioAvailable]:e,[R.GatewayAvailable]:a}=t;o=e?.status===T.False&&a?.status===T.False?"Istio resources and Istio Gateway resources are both unavailable":e?.status===T.False?"Istio resources are unavailable":a?.status===T.False?"Istio Gateway resources are unavailable":e?.status===T.True&&a?.status===T.True?"Deployment is unavailable":"Service is unavailable"}const m=o&&s.length,c=r().createElement(i.Label,{...m?{onClick:()=>{}}:{},"data-testid":"model-registry-label",icon:l,status:a,isCompact:!0},n);return o&&s.length?r().createElement(i.Popover,{headerContent:o,...n===v.Degrading?{alertSeverityVariant:"warning",headerIcon:r().createElement(N.Pi,null)}:{alertSeverityVariant:"danger",headerIcon:r().createElement(A.$Q,null)},bodyContent:r().createElement(i.Stack,{hasGutter:!0},s.map((e,t)=>r().createElement(i.StackItem,{key:`message-${t}`},e)))},c):c},P=({modelRegistry:e,roleBindings:t,onEditRegistry:a,onDeleteRegistry:n})=>{const s=(0,l.useNavigate)(),{config:o}=(0,k.J)(),{deploymentMode:m}=o,c=m===b.d.Kubeflow,d=t.data.filter(t=>t.metadata.labels?.["app.kubernetes.io/name"]===(e.metadata.name||e.metadata.annotations?.["openshift.io/display-name"]));return r().createElement(S.Tr,null,r().createElement(w.Td,{dataLabel:"Model registry name"},r().createElement(I.A,{resource:e},r().createElement("strong",null,e.metadata.annotations?.["openshift.io/display-name"]||e.metadata.name)),e.metadata.annotations?.["openshift.io/description"]&&r().createElement("p",null,e.metadata.annotations["openshift.io/description"])),r().createElement(w.Td,{dataLabel:"Status"},r().createElement(x,{conditions:e.status?.conditions})),r().createElement(w.Td,{modifier:"fitContent"},0===d.length?r().createElement(i.Tooltip,{content:"You can manage permissions when the model registry becomes available."},r().createElement(i.Button,{isAriaDisabled:!0,variant:"link"},"Manage permissions")):r().createElement(i.Button,{variant:"link",onClick:()=>s(`/model-registry-settings/permissions/${e.metadata.name}`)},"Manage permissions")),r().createElement(w.Td,{isActionCell:!0},r().createElement(C.G,{items:[{title:"Edit model registry",onClick:()=>{a(e)}},{title:"Delete model registry",disabled:c,onClick:()=>{n(e)}}]})))};var j=a(92406);const F=({modelRegistry:e,onClose:t,refresh:a})=>{const[n,l]=r().useState(!1),[s,o]=r().useState(),[m,c]=r().useState(""),d=m.trim()!==e.metadata.name||n,u=()=>{c(""),l(!1),o(void 0),t()},p=async()=>{l(!0),o(void 0);try{await(0,g.tU)("",{namespace:e.metadata.namespace})({},e,e.metadata.name),a(),u()}catch(e){e instanceof Error&&o(e),l(!1)}};return r().createElement(i.Modal,{"data-testid":"delete-mr-modal",isOpen:!0,onClose:t,variant:"medium"},r().createElement(i.ModalHeader,{title:"Delete model registry?",titleIconVariant:"warning"}),r().createElement(i.ModalBody,null,r().createElement(i.Stack,{hasGutter:!0},r().createElement(i.StackItem,null,r().createElement(i.Content,null,r().createElement(i.Content,{component:"p"},"The ",r().createElement("strong",null,e.metadata.name)," model registry, its default group, and any permissions associated with it will be deleted. Data located in the database connected to the registry will be unaffected."),r().createElement(i.Content,{component:"p"},"Type ",r().createElement("strong",null,e.metadata.name)," to confirm deletion:"))),r().createElement(i.StackItem,null,r().createElement(i.TextInput,{id:"confirm-delete-input","data-testid":"confirm-delete-input","aria-label":"Confirm delete input",value:m,onChange:(e,t)=>c(t),onKeyDown:e=>{"Enter"!==e.key||d||p()}})))),r().createElement(i.ModalFooter,null,r().createElement(j.A,{submitLabel:"Delete model registry",submitButtonVariant:"danger",onSubmit:p,onCancel:u,isSubmitLoading:n,isSubmitDisabled:d,error:s,alertTitle:"Error deleting model registry"})))};var M=a(62127),$=a(11640),G=a(73796),U=a(5600);const L=({ariaLabelShow:e="Show password",ariaLabelHide:t="Hide password",...a})=>{const[r,l]=n.useState(!0);return n.createElement(i.InputGroup,null,n.createElement(i.InputGroupItem,{isFill:!0},n.createElement(i.TextInput,{...a,type:r?"password":"text"})),n.createElement(i.InputGroupItem,null,n.createElement(i.Button,{"aria-label":r?e:t,variant:"control",onClick:()=>l(!r)},r?n.createElement(G.G3,null):n.createElement(U.bM,null))))},O=({password:e="",setPassword:t,showPassword:a,isPasswordTouched:n,setIsPasswordTouched:l})=>{return r().createElement(r().Fragment,null,r().createElement(L,{isRequired:!0,type:a?"text":"password",id:"mr-password",name:"mr-password",value:e,onBlur:()=>l(!0),onChange:(e,a)=>t(a),validated:n&&(i=e,!i.trim().length)?"error":"default"}));var i};var K=a(66241),H=a(31477);const q=()=>n.createElement(H.A,{content:n.createElement(i.Stack,{hasGutter:!0},n.createElement(i.StackItem,null,"The resource name is used to identify your resource, and is generated based on the name you enter."),n.createElement(i.StackItem,null,"The resource name cannot be edited after creation."))});var V=a(11438);const z=({allowEdit:e,dataTestId:t})=>{const{isMUITheme:a}=(0,K.w)();if(!e)return null;const r=n.createElement(i.TextInput,{id:`${t}-resourceName`,"data-testid":`${t}-resourceName`,name:`${t}-resourceName`,type:"text",isRequired:!0}),l=n.createElement(n.Fragment,null,n.createElement(i.FormGroup,{label:"Resource name",className:"resource-name",isRequired:!0,fieldId:`${t}-resource-name`},n.createElement(V.A,{component:r,field:"Host"})),n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,null,"The resource name is used to identify your resource, and is generated based on the name you enter. The resource name cannot be edited after creation.")));return a?l:r},X=({data:e,onDataChange:t,dataTestId:a,descriptionLabel:r="Description",nameLabel:l="Name",nameHelperText:s,hideDescription:o})=>{const[m,c]=n.useState(!1),{isMUITheme:d}=(0,K.w)(),u=n.createElement(i.TextInput,{"data-testid":`${a}-name`,id:`${a}-name`,name:`${a}-name`,value:e.name,onChange:(a,n)=>t({...e,name:n}),isRequired:!0}),p=n.createElement(n.Fragment,null,n.createElement(i.FormGroup,{label:l,isRequired:!0,fieldId:`${a}-name`},n.createElement(V.A,{component:u,field:"Name"})),s||!m?n.createElement(i.HelperText,null,s&&n.createElement(i.HelperTextItem,null,s),!m&&n.createElement(n.Fragment,null,n.createElement(i.HelperTextItem,null,n.createElement(i.Button,{"data-testid":`${a}-editResourceLink`,variant:"link",isInline:!0,onClick:()=>c(!0)},"Edit resource name")," ",n.createElement(q,null)))):null),g=n.createElement(i.TextInput,{"data-testid":`${a}-description`,id:`${a}-description`,name:`${a}-description`,type:"text",value:e.description,onChange:(a,n)=>t({...e,description:n})}),E=n.createElement(i.TextArea,{"data-testid":`${a}-description`,id:`${a}-description`,name:`${a}-description`,type:"text",value:e.description,onChange:(a,n)=>t({...e,description:n}),resizeOrientation:"vertical"}),b=n.createElement(i.FormGroup,{label:r,fieldId:`${a}-description`},n.createElement(V.A,{component:g,field:"Description"}));return n.createElement(n.Fragment,null,d?p:n.createElement(n.Fragment,null,n.createElement(i.FormGroup,{label:l,isRequired:!0,fieldId:`${a}-name`},u,s)),n.createElement(z,{allowEdit:m,dataTestId:a}),!o&&d?b:n.createElement(i.FormGroup,{label:r,fieldId:`${a}-description`},E))},Q=({children:e,label:t,fieldId:a,isRequired:r,helperTextNode:l,className:s})=>{const{isMUITheme:o}=(0,K.w)(),m=!!l;return o?n.createElement(n.Fragment,null,n.createElement(i.FormGroup,{className:`${s||""} ${m?"pf-m-error":""}`.trim(),label:t,isRequired:r,fieldId:a},n.createElement(V.A,{component:e,field:t})),l):n.createElement(n.Fragment,null,n.createElement(i.FormGroup,{className:`${s||""} ${m?"pf-m-error":""}`.trim(),label:t,isRequired:r,fieldId:a},e,l))},Y=({onClose:e,refresh:t})=>{const[a,r]=n.useState(),[l,s]=n.useState({name:"",description:""}),[o,m]=n.useState(""),[c,d]=n.useState(""),[u,p]=n.useState(""),[E,b]=n.useState(""),[y,f]=n.useState(""),[h,R]=n.useState(!1),[v,T]=n.useState(!1),[S,w]=n.useState(!1),[C,I]=n.useState(!1),[k,B]=n.useState(!1),[N,D]=n.useState(!1),A=(0,M.useNavigate)(),x=()=>{r(void 0),s({name:"",description:""}),m(""),d(""),p(""),b(""),f(""),R(!1),T(!1),w(!1),I(!1),B(!1),D(!1),e()},P=e=>!!e.trim().length,j=n.createElement(i.TextInput,{isRequired:!0,type:"text",id:"mr-host",name:"mr-host",value:o,onBlur:()=>R(!0),onChange:(e,t)=>m(t)}),F=h&&!P(o)&&n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,{variant:"error","data-testid":"mr-host-error"},"Host cannot be empty")),G=n.createElement(i.TextInput,{isRequired:!0,type:"text",id:"mr-port",name:"mr-port",value:c,onBlur:()=>T(!0),onChange:(e,t)=>d(t)}),U=v&&!P(c)&&n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,{variant:"error","data-testid":"mr-port-error"},"Port cannot be empty")),L=n.createElement(i.TextInput,{isRequired:!0,type:"text",id:"mr-username",name:"mr-username",value:u,onBlur:()=>w(!0),onChange:(e,t)=>p(t)}),K=S&&!P(u)&&n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,{variant:"error","data-testid":"mr-username-error"},"Username cannot be empty")),H=n.createElement(O,{password:E||"",setPassword:b,isPasswordTouched:C,setIsPasswordTouched:I,showPassword:N}),q=C&&!P(E)&&n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,{variant:"error","data-testid":"mr-password-error"},"Password cannot be empty")),V=n.createElement(i.TextInput,{isRequired:!0,type:"text",id:"mr-database",name:"mr-database",value:y,onBlur:()=>B(!0),onChange:(e,t)=>f(t)}),z=k&&!P(y)&&n.createElement(i.HelperText,null,n.createElement(i.HelperTextItem,{variant:"error","data-testid":"mr-database-error"},"Database cannot be empty"));return n.createElement(i.Modal,{isOpen:!0,variant:i.ModalVariant.medium,onClose:x,"data-testid":"create-model-registry-modal"},n.createElement(i.ModalHeader,{title:"Create model registry"}),n.createElement(i.ModalBody,null,n.createElement(i.Form,null,n.createElement(X,{dataTestId:"mr",data:l,onDataChange:s}),n.createElement($.A,{title:"Connect to external MySQL database",description:"This external database is where model data is stored."},n.createElement(Q,{label:"Host",fieldId:"mr-host",isRequired:!0,helperTextNode:F},j),n.createElement(Q,{label:"Port",fieldId:"mr-port",isRequired:!0,helperTextNode:U},G),n.createElement(Q,{label:"Username",fieldId:"mr-username",isRequired:!0,helperTextNode:K},L),n.createElement(Q,{label:"Password",fieldId:"mr-password",isRequired:!0,helperTextNode:q},H),n.createElement(Q,{label:"Database",fieldId:"mr-database",isRequired:!0,helperTextNode:z},V)),a&&n.createElement(i.FormGroup,null,n.createElement(i.Alert,{variant:"danger",isInline:!0,title:a.message,"data-testid":"mr-error"})))),n.createElement(i.ModalFooter,null,n.createElement(i.Button,{key:"create-button",variant:"primary",isDisabled:!(P(l.name)&&P(o)&&P(E)&&P(c)&&P(u)&&P(y)),onClick:async()=>{r(void 0);const a={modelRegistry:{metadata:{name:l.name,annotations:{"openshift.io/display-name":l.name,"openshift.io/description":l.description}},spec:{mysql:{host:o,port:Number(c),username:u,database:y}}}};try{await(0,g.Sq)(window.location.origin,{namespace:"model-registry"})({},a),t(),A("/model-registry-settings"),e()}catch(e){e instanceof Error&&r(e)}}},"Create"),n.createElement(i.Button,{key:"cancel-button",variant:"secondary",onClick:x},"Cancel")))},_=({modelRegistries:e,roleBindings:t,refresh:a,onCreateModelRegistryClick:n})=>{const[l,s]=r().useState(),[o,m]=r().useState();return r().createElement(r().Fragment,null,r().createElement(f.A,{"data-testid":"model-registries-table",data:e,columns:h,toolbarContent:r().createElement(i.Toolbar,null,r().createElement(i.ToolbarContent,null,r().createElement(i.ToolbarItem,null,r().createElement(i.Button,{"data-testid":"create-model-registry-button",variant:"primary",onClick:n},"Create model registry")))),rowRenderer:e=>r().createElement(P,{key:e.metadata.name,modelRegistry:e,roleBindings:t,onEditRegistry:()=>s(e),onDeleteRegistry:()=>m(e)}),variant:"compact"}),l?r().createElement(Y,{onClose:()=>s(void 0),refresh:a}):null,o?r().createElement(F,{modelRegistry:o,onClose:()=>m(void 0),refresh:a}):null)},J=()=>{const e=(0,d.f)(),[t,a,n]=E(e),l=y(e),[u,p]=r().useState(!1),g=a&&l.loaded;return r().createElement(r().Fragment,null,r().createElement(o.A,{title:r().createElement(m.A,{title:"Model Registry Settings",objectType:c.Xf.modelRegistrySettings}),description:r().createElement(i.Stack,{hasGutter:!0},r().createElement(i.StackItem,null,"Manage model registry settings for all users in your organization."),r().createElement(i.StackItem,null,r().createElement(i.Divider,null))),loaded:g,loadError:n,errorMessage:"Unable to load model registries.",empty:0===t.length,emptyStatePage:r().createElement(i.EmptyState,{headingLevel:"h5",icon:s.GY,titleText:"No model registries",variant:i.EmptyStateVariant.lg,"data-testid":"mr-settings-empty-state"},r().createElement(i.EmptyStateBody,null,"To get started, create a model registry. You can manage permissions after creation.")),provideChildrenPadding:!0},r().createElement(_,{modelRegistries:t,roleBindings:l,onCreateModelRegistryClick:()=>{p(!0)},refresh:()=>Promise.resolve()})),u?r().createElement(Y,{onClose:()=>p(!1),refresh:()=>Promise.resolve()}):null)};var W,Z,ee=a(49249);!function(e){e.USER="User",e.GROUP="Group"}(W||(W={})),function(e){e.EDIT="edit",e.ADMIN="admin",e.DEFAULT="default",e.CUSTOM="custom"}(Z||(Z={}));var te=a(97192),ae=a(59779),ne=a(44397),re=a(77459),le=a(83617),ie=a(74226),se=a(36842);const oe=()=>{const e=r().useCallback(e=>(0,g.pJ)("")(e),[]),[t,a,n]=(0,p.vT)(e,[]);return[t,a,n]},me=(e,t)=>e.filter(e=>e.subjects[0]?.kind===t&&!("true"===e.metadata.labels?.["opendatahub.io/rb-project-subject"])),ce=e=>e===Z.ADMIN?Z.ADMIN:e===Z.EDIT?Z.EDIT:e.includes("registry-user")?Z.DEFAULT:Z.CUSTOM,de=(e,t,a)=>(t&&a?pe(e.subjects[0]?.name.replace(/^system:serviceaccounts:/,""),a):e.subjects[0]?.name)||"",ue=e=>e===Z.EDIT?"Contributor":(0,i.capitalize)(e),pe=(e,t)=>{const a=t.find(t=>t.metadata.name===e);return a?(n=a,n.metadata.annotations?.["openshift.io/display-name"]||n.metadata.name):e;var n},ge=(e,t)=>t.find(t=>t.displayName===e)?.name||e;var Ee=a(93707);const be=({subjectKind:e,value:t,onChange:a,onClear:r,placeholderText:l,typeAhead:i,isProjectSubject:s})=>{const[o]=oe(),m=n.useMemo(()=>{let a=[];if("Group"===e&&i&&(a=i.map(e=>({value:e,content:e}))),s){const e=o.map(e=>({value:e.name,content:e.displayName||e.name}));a=[...a,...e]}return t&&!a.some(e=>e.value===t)&&a.push({value:t,content:t}),a},[e,i,s,o,t]);return n.createElement(Ee.A,{dataTestId:`role-binding-name-select ${t}`,isScrollable:!0,selectOptions:m,selected:t,isCreatable:!0,onClearSelection:r,onSelect:(e,t)=>{"string"==typeof t&&a?.(t)},placeholder:l||`Enter ${e.toLowerCase()} name`,createOptionMessage:e=>`Select "${e}"`})};var ye=a(66729);const fe=({selection:e,onSelect:t,permissionOptions:a})=>r().createElement(ye.A,{isFullWidth:!0,options:a.map(e=>({...e,label:ue(e.type),key:e.type})),value:e,toggleLabel:ue(e),onChange:e=>{t(ce(e))},popperProps:{direction:"down"},previewDescription:!1}),he=({children:e,title:t,onClose:a,deleting:r,onDelete:l,deleteName:s,error:o,submitButtonLabel:m="Delete",testId:c,genericLabel:d})=>{const[u,p]=n.useState(""),g=n.useMemo(()=>s.trim().replace(/\s+/g," "),[s]),E=e=>{e?l():a()};return n.createElement(i.Modal,{isOpen:!0,onClose:()=>E(!1),variant:"small","data-testid":c||"delete-modal"},n.createElement(i.ModalHeader,{title:t,titleIconVariant:"warning"}),n.createElement(i.ModalBody,null,n.createElement(i.Stack,{hasGutter:!0},n.createElement(i.StackItem,null,e),n.createElement(i.StackItem,null,n.createElement(i.Flex,{direction:{default:"column"},spaceItems:{default:"spaceItemsSm"}},n.createElement(i.FlexItem,null,"Type ",n.createElement("strong",null,g)," to confirm",d?"":" deletion",":"),n.createElement(i.TextInput,{id:"delete-modal-input","data-testid":"delete-modal-input","aria-label":"Delete modal input",value:u,onChange:(e,t)=>p(t),onKeyDown:e=>{"Enter"!==e.key||u.trim()!==g||r||l()}}))),o&&n.createElement(i.StackItem,null,n.createElement(i.Alert,{"data-testid":"delete-model-error-message-alert",title:`Error deleting ${g}`,isInline:!0,variant:"danger"},o.message)))),n.createElement(i.ModalFooter,null,n.createElement(i.Button,{key:"delete-button",variant:"danger",isLoading:r,isDisabled:r||u.trim()!==g,onClick:()=>E(!0)},m),n.createElement(i.Button,{key:"cancel-button",variant:"link",onClick:()=>E(!1)},"Cancel")))},Re=({onClose:e,onEdit:t,onDelete:a,isDeleting:r,roleName:l})=>{const i=r?"Delete":"Edit",[s,o]=n.useState(!1);return n.createElement(he,{title:`Confirm ${i.toLowerCase()}`,onClose:e,deleting:s,onDelete:()=>{o(!0),r?a():t()},deleteName:l||"delete",submitButtonLabel:r?"Delete":"Save",genericLabel:!0},"Are you sure you want to ",r?"delete":"edit"," permissions for"," ",n.createElement("strong",null,l||"this role binding"),"? ",r?"Deleting":"Editing"," ","these permissions may result in loss of access to this resource.")},ve=(e,t,a)=>t&&a?a.find(t=>t.name===e.subjects[0]?.name.replace(/^system:serviceaccounts:/,""))?.displayName||e.subjects[0]?.name||"":e.subjects[0]?.name||"",Te=e=>ce(e.roleRef.name),Se=({roleBindingObject:e,subjectKind:t,isEditing:a,isAdding:r,defaultRoleBindingName:l,permissionOptions:s,typeAhead:o,isProjectSubject:m,onChange:c,onCancel:d,onEdit:u,onDelete:p})=>{const[g,E]=oe(),b=(0,se.A)(),y=(f=e,h=b.userId,!!f&&h===f.subjects[0].name);var f,h;const[R,v]=n.useState(()=>r||!e?"":ve(e,m,g)),[T,I]=n.useState(()=>r||!e?s[0]?.type:Te(e)),[k,B]=n.useState(!1),N=e?.metadata.creationTimestamp?new Date(e.metadata.creationTimestamp):null,D=e?.metadata.name===l,[A,x]=n.useState(!1),[P,j]=n.useState(!1);n.useEffect(()=>{E&&e&&!r&&m&&v(ve(e,m,g))},[E,e,r,m,g]),n.useEffect(()=>{!a&&e&&(v(m?ve(e,m,g):ve(e)),I(Te(e)))},[e,a,m,g]);const F=m&&!E;return n.createElement(n.Fragment,null,n.createElement(te.N,null,n.createElement(S.Tr,null,n.createElement(w.Td,{dataLabel:"Username"},a||r?F?n.createElement(i.Skeleton,{height:"36px"}):n.createElement(be,{subjectKind:t,value:R,onChange:e=>v(e),onClear:()=>v(""),placeholderText:"Type "+(m?"project name":"Group"===t?"group name":"username"),typeAhead:o,isProjectSubject:m}):F?n.createElement(i.Skeleton,{height:"20px"}):n.createElement(i.Truncate,{content:R})),n.createElement(w.Td,{dataLabel:"Permission"},a||r?n.createElement(fe,{permissionOptions:s,selection:T,onSelect:e=>I(e)}):ue(T)),n.createElement(w.Td,{dataLabel:"Date added"},N&&!r?n.createElement(i.Timestamp,{date:N,tooltip:{variant:i.TimestampTooltipVariant.default}},(0,le.K)(Date.now(),N.getTime())):null),n.createElement(w.Td,{isActionCell:!0},a||r?n.createElement(i.Split,{hasGutter:!0},n.createElement(i.SplitItem,null,n.createElement(i.Button,{"data-testid":"save-rolebinding-button","aria-label":"Save role binding edits",variant:"link",icon:n.createElement(ae.Sr,null),onClick:async()=>{if(R){B(!0);try{await(c?.(m?`system:serviceaccounts:${ge(R,g)}`:R,T))}finally{B(!1)}}},isLoading:k,isDisabled:k||!R||F})),n.createElement(i.SplitItem,null,n.createElement(i.Button,{"aria-label":"Cancel role binding edits",variant:"plain",icon:n.createElement(ne.AX,null),onClick:()=>{d?.()},isDisabled:k}))):n.createElement(C.G,{items:[{title:"Edit",onClick:()=>{y?(j(!1),x(!0)):u?.()},isDisabled:F},{isSeparator:!0},{title:"Delete",onClick:()=>{y?(j(!0),x(!0)):p?.()},isDisabled:D||F}],rowData:{},actionsToggle:e=>n.createElement(ie.A,{icon:n.createElement(re.bz,null),"aria-label":"Role binding table row actions",...e})})))),A&&n.createElement(Re,{onClose:()=>x(!1),onEdit:()=>{x(!1);const e=m?`system:serviceaccounts:${ge(R,g)}`:R;c?.(e,T)},onDelete:()=>{x(!1),p?.()},isDeleting:P,roleName:R}))},we=[{field:"username",label:"Name",width:30,sortable:(e,t)=>de(e).localeCompare(de(t))},{field:"permission",label:"Permission",width:20,sortable:(e,t)=>e.roleRef.name.localeCompare(t.roleRef.name)},{field:"date",label:"Date added",width:25,sortable:(e,t)=>new Date(t.metadata.creationTimestamp||0).getTime()-new Date(e.metadata.creationTimestamp||0).getTime()}],Ce=({ownerReference:e,subjectKind:t,namespace:a,roleRefKind:r,roleRefName:l,labels:i,isProjectSubject:s,defaultRoleBindingName:o,permissions:m,permissionOptions:c,isAdding:d,typeAhead:u,createRoleBinding:p,deleteRoleBinding:E,onDismissNewRow:b,onError:y,refresh:h})=>{const[R,v]=n.useState([]),T=async(e,t)=>{if(d)p(e).then(()=>{b(),h()}).catch(e=>{y(n.createElement(n.Fragment,null,e))});else if(t){const a=await(async(e,t)=>{if(e.roleRef.name!==t.roleRef.name)return!1;try{await(0,g.CF)("",{namespace:e.metadata.namespace,dryRun:!0})({},t,e.metadata.name)}catch{return!1}try{return await(0,g.CF)("",{namespace:e.metadata.namespace,dryRun:!1})({},t,e.metadata.name),!0}catch{return!1}})(t,e);a?(v(e=>e.filter(e=>e!==t.metadata.name)),b(),h()):p(e).then(()=>{E(t.metadata.name,t.metadata.namespace).then(()=>h()).catch(e=>{y(n.createElement(n.Fragment,null,e)),v(e=>e.filter(e=>e!==t.metadata.name))})}).then(()=>{b(),h()}).catch(e=>{y(n.createElement(n.Fragment,null,e)),v(e=>e.filter(e=>e!==t.metadata.name))})}};return n.createElement(f.A,{variant:"compact",data:m,"data-testid":`role-binding-table ${t}`,columns:we,disableRowRenderSupport:!0,footerRow:()=>d?n.createElement(Se,{key:"add-permissions-row",subjectKind:t,permissionOptions:c,isProjectSubject:s,typeAhead:u,isEditing:!1,isAdding:!0,onChange:(n,s)=>{const o=(0,g.Tn)(a,t,n,l||s,r,i,e);p(o).then(()=>{b(),h()}).catch(e=>y(e?.message||e||"Unknown error"))},onCancel:b}):null,rowRenderer:m=>n.createElement(Se,{isProjectSubject:s,defaultRoleBindingName:o,key:m.metadata.name||"",permissionOptions:c,roleBindingObject:m,subjectKind:t,isEditing:""===de(m,s)||R.includes(m.metadata.name),isAdding:!1,typeAhead:u,onChange:(n,s)=>{const o=(0,g.Tn)(a,t,n,l||s,r,i,e);T(o,m),h()},onDelete:()=>{E(m.metadata.name,m.metadata.namespace).then(()=>h())},onEdit:()=>{v(e=>[...e,m.metadata.name])},onCancel:()=>{v(e=>e.filter(e=>e!==m.metadata.name)),b()}})})},Ie=({ownerReference:e,roleBindings:t,projectName:a,roleRefKind:r,roleRefName:l,subjectKind:o,permissionOptions:m,typeAhead:d,createRoleBinding:u,deleteRoleBinding:p,refresh:g,typeModifier:E,defaultRoleBindingName:b,labels:y,isProjectSubject:f})=>{const[h,R]=n.useState(!1),[v,T]=n.useState();return n.createElement(i.Stack,{hasGutter:!0},n.createElement(i.StackItem,null,n.createElement(i.Flex,{direction:{default:"row"},gap:{default:"gapSm"},alignItems:{default:"alignItemsCenter"},className:E},n.createElement(ee.A,{type:f?c.Xf.project:o===W.USER?c.Xf.user:c.Xf.group}),n.createElement(i.FlexItem,null,n.createElement(i.Title,{id:`user-permission-${E}`,headingLevel:"h2",size:"xl"},f?"Projects":o===W.USER?"Users":"Groups")))),n.createElement(i.StackItem,null,n.createElement(Ce,{ownerReference:e,defaultRoleBindingName:b,permissions:t,permissionOptions:m,namespace:a,roleRefKind:r,roleRefName:l,isProjectSubject:f,labels:y,subjectKind:o,typeAhead:d,isAdding:h,onDismissNewRow:()=>{R(!1),T(void 0)},onError:e=>{T(e)},refresh:()=>{g()},createRoleBinding:u,deleteRoleBinding:p})),v&&n.createElement(i.StackItem,null,n.createElement(i.Alert,{isInline:!0,variant:"danger",title:"Error",actionClose:n.createElement(i.AlertActionCloseButton,{onClose:()=>T(void 0)})},n.createElement("p",null,v))),n.createElement(i.StackItem,null,n.createElement(i.Button,{"data-testid":`add-button ${E}`,variant:"link",isInline:!0,icon:n.createElement(s.GY,null),iconPosition:"left",onClick:()=>R(!0),style:{paddingLeft:"var(--pf-t--global--spacer--lg)"}},f?"Add project":o===W.USER?"Add user":"Add group")))},ke=({ownerReference:e,roleBindingPermissionsRB:t,defaultRoleBindingName:a,permissionOptions:r,projectName:l,createRoleBinding:s,deleteRoleBinding:o,roleRefKind:m,roleRefName:c,labels:d,description:u,groups:p,isGroupFirst:g=!1,isProjectSubject:E=!1})=>{const{data:b,loaded:y,error:f,refresh:h}=t;if(f)return n.createElement(i.EmptyState,{headingLevel:"h2",icon:A.$Q,titleText:"There was an issue loading permissions.",variant:i.EmptyStateVariant.lg,"data-id":"error-empty-state",id:"permissions"},n.createElement(i.EmptyStateBody,null,f.message));if(!y)return n.createElement(i.EmptyState,{headingLevel:"h2",titleText:"Loading",variant:i.EmptyStateVariant.lg,"data-id":"loading-empty-state",id:"permissions"},n.createElement(i.Spinner,{size:"xl"}));const R=n.createElement(Ie,{ownerReference:e,defaultRoleBindingName:a,projectName:l,roleRefKind:m,roleRefName:c,labels:d,permissionOptions:r,roleBindings:me(b,W.USER),subjectKind:W.USER,refresh:h,typeModifier:"user",createRoleBinding:s,deleteRoleBinding:o,isProjectSubject:E}),v=n.createElement(Ie,{ownerReference:e,defaultRoleBindingName:a,projectName:l,roleRefKind:m,roleRefName:c,permissionOptions:r,labels:d,roleBindings:me(b,W.GROUP),subjectKind:W.GROUP,refresh:h,typeAhead:p.length>0?p.map(e=>e.metadata.name):void 0,typeModifier:"group",createRoleBinding:s,deleteRoleBinding:o,isProjectSubject:E});return n.createElement(i.PageSection,{hasBodyWrapper:!1,isFilled:!0,"aria-label":"project-sharing-page-section",id:"permissions"},n.createElement(i.Stack,{hasGutter:!0},n.createElement(i.Alert,{variant:"warning",title:"Warning",isInline:!0},"Changing user or group permissions may remove their access to this resource."),n.createElement(i.StackItem,null,u),n.createElement(i.StackItem,null,g?v:R),n.createElement(i.StackItem,null,g?R:v)))},Be=async e=>{const t=window.location.origin;return(0,g.sq)(t,{})({},e)},Ne=async(e,t)=>{const a=window.location.origin;return await(0,g.Te)(a,{})({},e),{apiVersion:"v1",kind:"Status",status:"Success",code:200,message:"Role binding deleted successfully",reason:"Deleted"}},De=async e=>{const t=window.location.origin,a={...e,metadata:{...e.metadata,labels:{...e.metadata.labels,"app.kubernetes.io/component":"model-registry-namespace-rbac"}}};return(0,g.sq)(t,{})({},a)},Ae=async(e,t)=>{const a=window.location.origin;return await(0,g.Te)(a,{})({},e),{apiVersion:"v1",kind:"Status",status:"Success",code:200,message:"Namespace role binding deleted successfully",reason:"Deleted"}},xe=()=>{const[e,t]=r().useState(0),a="model-registry",[n,i]=r().useState(),s=(0,d.f)(),[o]=((e={})=>{const t=r().useCallback(t=>(0,g.f)("",e)(t),[e]),[a,n,l]=(0,p.vT)(t,[]);return[a,n,l]})(s),m=y(s),{mrName:c}=(0,l.useParams)(),[E,b]=((e,t)=>{const a=(0,u.r)(t),n=r().useMemo(()=>(0,g.Iu)("",a),[a]),l=r().useCallback(t=>e?n(t,e).then(e=>e.modelRegistry):Promise.resolve(null),[n,e]);return(0,p.vT)(l,null,{initialPromisePurity:!0})})(a,s),f=m.data.filter(e=>e.metadata.labels?.["app.kubernetes.io/name"]===c),h=m.data.filter(e=>e.metadata.labels?.["app.kubernetes.io/name"]===c&&"model-registry-namespace-rbac"===e.metadata.labels?.["app.kubernetes.io/component"]);r().useEffect(()=>{i(E||void 0)},[E]);const R=[{type:Z.DEFAULT,description:"Default role for all users"}],v=[{type:Z.DEFAULT,description:"Default namespace access role"}],T=`registry-user-${c??""}`,S=`registry-namespace-${c??""}`,w=!s.namespace,C=m.loaded&&0===f.length||b&&!E;return{activeTabKey:e,setActiveTabKey:t,ownerReference:n,groups:o,filteredRoleBindings:f,filteredNamespaceRoleBindings:h,queryParams:s,mrName:c,modelRegistryNamespace:a,roleBindings:m,userPermissionOptions:R,namespacePermissionOptions:v,createUserRoleBinding:Be,deleteUserRoleBinding:Ne,createNamespaceRoleBinding:De,deleteNamespaceRoleBinding:Ae,userRoleRefName:T,namespaceRoleRefName:S,shouldShowError:w,shouldRedirect:C}},Pe=()=>{const{activeTabKey:e,setActiveTabKey:t,ownerReference:a,groups:n,filteredRoleBindings:s,filteredNamespaceRoleBindings:o,mrName:m,modelRegistryNamespace:c,roleBindings:d,userPermissionOptions:u,namespacePermissionOptions:p,createUserRoleBinding:g,deleteUserRoleBinding:E,createNamespaceRoleBinding:b,deleteNamespaceRoleBinding:y,userRoleRefName:f,namespaceRoleRefName:h,shouldShowError:R,shouldRedirect:v}=xe();return R?r().createElement(i.EmptyState,{headingLevel:"h2",icon:A.$Q,titleText:"There was an issue loading permissions.",variant:i.EmptyStateVariant.lg,"data-id":"error-empty-state",id:"permissions"},r().createElement(i.EmptyStateBody,null,"Unable to load model registry permissions. Refresh the page to try again.")):v?r().createElement(l.Navigate,{to:"/modelRegistrySettings",replace:!0}):r().createElement(r().Fragment,null,r().createElement(i.Title,{headingLevel:"h2",size:"xl"},"Manage ",m," permissions"),r().createElement(i.Tabs,{activeKey:e,onSelect:(e,a)=>t(Number(a)),usePageInsets:!0,id:"manage-permissions-tabs"},r().createElement(i.Tab,{eventKey:0,title:r().createElement(i.TabTitleText,null,"Users")},r().createElement(ke,{ownerReference:a,roleBindingPermissionsRB:{...d,data:s},groups:n,createRoleBinding:g,deleteRoleBinding:E,projectName:c,permissionOptions:u,description:"To enable access for all cluster users, add system:authenticated to the group list.",roleRefKind:"ClusterRole",roleRefName:f})),r().createElement(i.Tab,{eventKey:1,title:r().createElement(i.TabTitleText,null,"Namespaces")},r().createElement(ke,{ownerReference:a,roleBindingPermissionsRB:{...d,data:o},groups:[],createRoleBinding:b,deleteRoleBinding:y,projectName:c,permissionOptions:p,description:"Grant access to model registry for service accounts within specific namespaces.",roleRefKind:"ClusterRole",roleRefName:h,isProjectSubject:!0}))))},je=()=>n.createElement(l.Routes,null,n.createElement(l.Route,{path:"/",element:n.createElement(J,null)}),n.createElement(l.Route,{path:"permissions/:mrName",element:n.createElement(Pe,null)}),n.createElement(l.Route,{path:"*",element:n.createElement(l.Navigate,{to:"/"})}))}}]);
//# sourceMappingURL=859.bundle.js.map