openapi: 3.0.3
info:
  title: 'EvalHub REST API'
  version: '1.0.0'
  description: 'REST API for EvalHub Backend for Frontend (BFF) using OpenAI SDK v2'
  license:
    name: Apache 2.0
    url: 'https://www.apache.org/licenses/LICENSE-2.0'
servers:
  - url: 'http://localhost:4000'
    description: 'Local development server'

security:
  - Bearer: []

paths:
  # =============================================================================
  # UTILITY ENDPOINTS
  # =============================================================================

  /healthcheck:
    summary: BFF service health check
    description: >-
      Health check endpoint to verify BFF service availability. This is a local
      service check and does not validate external EvalHub connectivity.
    get:
      tags:
        - HealthCheck
      responses:
        '200':
          $ref: '#/components/responses/HealthCheckResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: healthcheck
      summary: BFF Health Check
      description: Returns BFF service status and version information.
      security: []

  /eval-hub/api/v1/health:
    summary: EvalHub API health status
    description: >-
      Returns the health and version status of the BFF API layer.
      Does not require namespace context.
    get:
      tags:
        - HealthCheck
      responses:
        '200':
          $ref: '#/components/responses/HealthResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: health
      summary: API Health
      description: Returns API availability status and version information.
      security: []

  # =============================================================================
  # KUBERNETES ENDPOINTS
  # =============================================================================

  /eval-hub/api/v1/namespaces:
    summary: List Kubernetes cluster namespaces
    description: >-
      Lists all namespaces in the Kubernetes cluster.
      Returns namespace information including name and display name.
      Requires valid Kubernetes authentication token.
    get:
      tags:
        - Kubernetes
      security:
        - Bearer: []
      responses:
        '200':
          $ref: '#/components/responses/NamespacesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: listNamespaces
      summary: List All Namespaces
      description: Gets a list of all namespaces in the Kubernetes cluster.

  /eval-hub/api/v1/user:
    summary: Get current user information
    description: >-
      Retrieves information about the currently authenticated user.
      Returns user details including identity and permissions.
    get:
      tags:
        - Identity
      security:
        - Bearer: []
      parameters:
        - $ref: '#/components/parameters/kubeflowUserId'
      responses:
        '200':
          $ref: '#/components/responses/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: getCurrentUser
      summary: Get Current User
      description: Returns information about the currently authenticated user.

  # =============================================================================
  # EVALHUB EVALUATION ENDPOINTS
  # =============================================================================

  /eval-hub/api/v1/evaluations/collections:
    summary: List benchmark collections
    description: >-
      Lists all benchmark collections from the EvalHub control plane.
      Returns collections with their benchmarks, tags, and metadata.
    get:
      tags:
        - Collections
      security:
        - Bearer: []
      responses:
        '200':
          $ref: '#/components/responses/CollectionsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: listCollections
      summary: List Collections
      description: Gets a list of all benchmark collections from the EvalHub server.

  /eval-hub/api/v1/evaluations/jobs:
    summary: List evaluation jobs
    description: >-
      Lists all evaluation jobs from the EvalHub control plane.
      Returns jobs with their status, framework, model, and metadata.
    get:
      tags:
        - Evaluations
      security:
        - Bearer: []
      responses:
        '200':
          $ref: '#/components/responses/EvaluationJobsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      operationId: listEvaluationJobs
      summary: List Evaluation Jobs
      description: Gets a list of all evaluation jobs from the EvalHub server.

components:
  # =============================================================================
  # SCHEMAS
  # =============================================================================
  schemas:
    HealthCheckModel:
      type: object
      required:
        - status
        - system_info
      properties:
        status:
          type: string
          example: 'available'
          description: BFF service availability status
        system_info:
          $ref: '#/components/schemas/SystemInfo'

    SystemInfo:
      type: object
      required:
        - version
      properties:
        version:
          type: string
          example: '1.0.0'
          description: BFF service version

    HealthResponse:
      type: object
      required:
        - status
        - system_info
      properties:
        status:
          type: string
          example: 'available'
          description: API availability status
        system_info:
          $ref: '#/components/schemas/SystemInfo'

    NamespaceModel:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: 'default'
          description: Kubernetes namespace name
        displayName:
          type: string
          nullable: true
          example: 'default'
          description: Human-readable display name for the namespace (optional, defaults to name)

    NamespacesData:
      type: array
      items:
        $ref: '#/components/schemas/NamespaceModel'
      description: Array of Kubernetes namespaces

    UserModel:
      type: object
      required:
        - userId
        - clusterAdmin
      properties:
        userId:
          type: string
          example: 'user@example.com'
        clusterAdmin:
          type: boolean
          example: true

    EvaluationJob:
      type: object
      required:
        - id
        - name
        - status
      properties:
        id:
          type: string
          example: 'eval-job-001'
          description: Unique identifier for the evaluation job
        name:
          type: string
          example: 'mmlu-benchmark'
          description: Human-readable name for the evaluation job
        status:
          type: string
          enum:
            - pending
            - running
            - completed
            - failed
            - cancelled
          example: 'completed'
          description: Current status of the evaluation job
        framework:
          type: string
          example: 'lm-eval'
          description: Evaluation framework used (e.g. lm-eval, deepeval)
        model:
          type: string
          example: 'meta-llama/Llama-3.1-8B-Instruct'
          description: Model being evaluated
        created_at:
          type: string
          format: date-time
          example: '2026-02-20T10:00:00Z'
          description: Timestamp when the job was created
        updated_at:
          type: string
          format: date-time
          example: '2026-02-20T11:30:00Z'
          description: Timestamp when the job was last updated
        labels:
          type: object
          additionalProperties:
            type: string
          example:
            category: 'benchmark'
          description: Key-value labels for the evaluation job

    EvaluationJobsData:
      type: array
      items:
        $ref: '#/components/schemas/EvaluationJob'
      description: Array of evaluation jobs

    CollectionResource:
      type: object
      properties:
        id:
          type: string
          example: 'collection-001'
        tenant:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true
        read_only:
          type: boolean
          nullable: true
        owner:
          type: string
          nullable: true

    CollectionPrimaryScore:
      type: object
      required:
        - metric
        - lower_is_better
      properties:
        metric:
          type: string
        lower_is_better:
          type: boolean

    CollectionPassCriteria:
      type: object
      required:
        - threshold
      properties:
        threshold:
          type: number

    CollectionBenchmark:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          example: 'arc_challenge'
        provider_id:
          type: string
          nullable: true
        weight:
          type: number
          nullable: true
        primary_score:
          $ref: '#/components/schemas/CollectionPrimaryScore'
        pass_criteria:
          $ref: '#/components/schemas/CollectionPassCriteria'
        parameters:
          type: object
          additionalProperties: true
          nullable: true

    Collection:
      type: object
      properties:
        resource:
          $ref: '#/components/schemas/CollectionResource'
        name:
          type: string
          example: 'Open LLM Leaderboard v2'
        description:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string
          nullable: true
        custom:
          type: object
          additionalProperties: true
          nullable: true
        pass_criteria:
          $ref: '#/components/schemas/CollectionPassCriteria'
        benchmarks:
          type: array
          items:
            $ref: '#/components/schemas/CollectionBenchmark'
          nullable: true

    CollectionsData:
      type: array
      items:
        $ref: '#/components/schemas/Collection'
      description: Array of benchmark collections

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          example: '400'
          description: HTTP status code
        message:
          type: string
          example: 'Bad request'
          description: Human-readable error message

    ErrorEnvelope:
      type: object
      required:
        - error
      properties:
        error:
          $ref: '#/components/schemas/Error'

  # =============================================================================
  # RESPONSES
  # =============================================================================
  responses:
    HealthCheckResponse:
      description: BFF service health status
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HealthCheckModel'
          example:
            status: 'available'
            system_info:
              version: '1.0.0'

    HealthResponse:
      description: API health status
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/HealthResponse'
          example:
            status: 'available'
            system_info:
              version: '1.0.0'

    NamespacesResponse:
      description: List of Kubernetes namespaces
      content:
        application/json:
          schema:
            type: object
            required:
              - data
            properties:
              data:
                $ref: '#/components/schemas/NamespacesData'
          example:
            data:
              - name: 'default'
                displayName: 'default'
              - name: 'eval-workloads'
                displayName: 'eval-workloads'

    UserResponse:
      description: Current user information
      content:
        application/json:
          schema:
            type: object
            required:
              - data
            properties:
              data:
                $ref: '#/components/schemas/UserModel'
          example:
            data:
              userId: 'user@example.com'
              clusterAdmin: true

    EvaluationJobsResponse:
      description: List of evaluation jobs from EvalHub
      content:
        application/json:
          schema:
            type: object
            required:
              - data
            properties:
              data:
                $ref: '#/components/schemas/EvaluationJobsData'
          example:
            data:
              - id: 'eval-job-001'
                name: 'mmlu-benchmark'
                status: 'completed'
                framework: 'lm-eval'
                model: 'meta-llama/Llama-3.1-8B-Instruct'
                created_at: '2026-02-20T10:00:00Z'
                updated_at: '2026-02-20T11:30:00Z'
                labels:
                  category: 'benchmark'
              - id: 'eval-job-002'
                name: 'hellaswag-eval'
                status: 'running'
                framework: 'lm-eval'
                model: 'mistralai/Mistral-7B-v0.1'
                created_at: '2026-02-24T08:00:00Z'
                labels:
                  category: 'benchmark'

    CollectionsResponse:
      description: List of benchmark collections from EvalHub
      content:
        application/json:
          schema:
            type: object
            required:
              - data
            properties:
              data:
                $ref: '#/components/schemas/CollectionsData'
          example:
            data:
              - resource:
                  id: 'collection-001'
                name: 'Open LLM Leaderboard v2'
                description: 'Comprehensive evaluation suite for general-purpose language models.'
                tags:
                  - 'Comprehensive'
                  - 'Industry Standard'
                benchmarks:
                  - id: 'arc_challenge'
                    provider_id: 'lm_evaluation_harness'
                    weight: 1

    BadRequest:
      description: Bad Request - Invalid parameters or missing required fields
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorEnvelope'
          example:
            error:
              code: '400'
              message: 'missing required query parameter: namespace'

    Unauthorized:
      description: Unauthorized - Invalid or missing authentication token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorEnvelope'

    NotFound:
      description: Not Found - Requested resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorEnvelope'

    InternalServerError:
      description: Internal Server Error - Server encountered an unexpected condition
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorEnvelope'

  # =============================================================================
  # PARAMETERS
  # =============================================================================
  parameters:
    kubeflowUserId:
      in: header
      name: kubeflow-userid
      schema:
        type: string
      required: true
      description: User email address from Kubeflow authentication
    namespace:
      name: namespace
      description: Kubernetes namespace to scope the request
      schema:
        type: string
      in: query
      required: true

  # =============================================================================
  # SECURITY
  # =============================================================================
  securitySchemes:
    Bearer:
      type: apiKey
      in: header
      name: x-forwarded-access-token
      description: User access token (use `oc whoami -t` to get your cluster token)

tags:
  - name: HealthCheck
    description: Health check and status endpoints
  - name: Kubernetes
    description: Kubernetes cluster operations
  - name: Identity
    description: User identity and authentication
  - name: Evaluations
    description: LLM evaluation job management via EvalHub
  - name: Collections
    description: Benchmark collection management via EvalHub
